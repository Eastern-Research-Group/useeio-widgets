<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Sector Contribution to Impact</title>
    <link rel="stylesheet" type="text/css" href="widgets.css">
</head>


<body>
    <h1 id="graphTitle" class="text-center">Top 10 Sectors based on Total Embodied GHG Emissions</h1>
	<p>For the selected group of sectors, this chart compares the contribution to total impacts (Global Warming Potential(GWP) or Social Cost of Carbon(SCC)) or Emission Intensity from <em>Direct</em> emissions from facility operations and <em>Indirect</em> emissions embedded in the purchases made from all other sectors.</p>
    <div style=" display: flex; flex-direction: column;height: 85vh;">
        <div style=" flex-grow: 1;">
                    <div id="smart-sector-eeio">
                    </div>
        </div>
        <div style=" flex-grow: 1;">
            <div style=" display: flex; flex-direction: row;">
                <div style=" margin-left: 20px;flex-grow: 1;">
                    <label for="metric-selected">Select Metric (GWP or SCC):</label>
                    <br>
                    <select id="my-select" onchange="changeGraph(this.value)">
                        <option value="GWP-AR6-20" >20yr GWP </option>
                        <option value="GWP-AR6-100" selected>100yr GWP</option>
                        <option value="Social-Cost-of-Carbon">Social Cost of Carbon</option>
                    </select>
                </div>
                <div style=" margin-left: 20px;flex-grow: 1;">
                    <label for="allocation-selected">Results Perspective:</label>
                    <br>
                    <input type="radio" name="myRadios" value="final" checked/> Point of Consumption
                    <input type="radio" name="myRadios" value="direct" /> Supply Chain Hotspots
                </div>
                <div style=" margin-left: 20px;flex-grow: 1;">
                    <label for="grap-selected">Top Sectors: </label>
                    <br>
                    <select id="mySelect" onchange="toggleNumSelection(this.value)">
                        <option data-value='{"name":"total_rank","num":"10"}'>Top 10 Total Embodied GHG</option>
                        <option data-value='{"name":"total_rank","num":"25"}'>Top 25 Total Embodied GHG</option>
                        <option data-value='{"name":"intensity_rank","num":"10"}'>Top 10 Embodied GHG Intensity</option>
                        <option data-value='{"name":"intensity_rank","num":"25"}'>Top 25 Embodied GHG Intensity</option>
                    </select>
                </div>

                <div style=" margin-left: 20px;flex-grow: 1;">
                    <label for="impact-selected">Select Result View:</label>
                    <br>
                    <input type="radio" name="impactRadio" value="total_impact" checked/> Total Emissions
                    <input type="radio" name="impactRadio" value="impact_per_purchase" /> Emission Intensity
                </div>
                <div style=" margin-left: 20px;flex-grow: 1;">
                    <label for="group-selected">Sector Grouping:</label>
                    <br>
                    <input type="radio" name="groupRadio" value="group_detail" checked/> Detailed
                    <input type="radio" name="groupRadio" value="group_summary" /> Simple
                    <input type="radio" name="groupRadio" value="group_direct" /> Direct vs Indirect
                </div>
        </div>
        </div>
        
    </div>
    
   

    <script src="lib/apexcharts.min.js"></script>
    <script src="lib/useeio_widgets.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

<script  type="text/javascript"> 
        var perspectiveName = 'final';
        var graphType = 'GWP-AR6-100';
        var topSectors = 10;
        var groupSelector = 'group_detail';
        var impactSelector = 'total_impact';
        var config = useeio.urlConfig();
        var modelID = config.get().model || 'SMART_SECTORv1.0';

        var model = useeio.model({
            endpoint: './api',
            model: modelID,
            asJsonFiles: true,
        });

        var smartSectorChart = useeio.smartSectorChart({
            model: model,
            endpoint: './api',
            selector: '#smart-sector-eeio',
        });
        smartSectorChart.init(graphType);

    function changeGraph(t)
            {
                smartSectorChart.selectiveGraph(t,perspectiveName);
                graphType = t;
            }
    
    function changeGroup()
            {
                smartSectorChart.selectiveGraph(graphType,perspectiveName,topSectors,impactSelector,groupSelector);
            }

    function changeImpactSelector()
            {
                smartSectorChart.selectiveGraph(graphType,perspectiveName,topSectors,impactSelector,groupSelector);
            }

    

            document.addEventListener('input',(e)=>{
                if(e.target.getAttribute('name')=="myRadios")
                {
                    perspectiveName = e.target.value
                    changeGraph(graphType);

                }
            })

            document.addEventListener('input',(e)=>{
                if(e.target.getAttribute('name')=="impactRadio")
                {
                    impactSelector = e.target.value
                    changeImpactSelector();

                }
            })

            document.addEventListener('input',(e)=>{
                if(e.target.getAttribute('name')=="groupRadio")
                {
                    groupSelector = e.target.value
                    changeGroup();
                }
            })

            function toggleNumSelection(n)
            {
                smartSectorChart.selectorFilter($('#mySelect').find(":selected").data("value"));

                topSectors = $('#mySelect').find(":selected").data("value").num;
                document.getElementById("graphTitle").innerHTML = `Top ${n} Sectors based on Total Embodied GHG Emissions`; 
            }

          
        </script>
</body>

</html>
